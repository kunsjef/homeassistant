- platform: template
  sensors:

    alarm_clock_time:
      friendly_name: 'Alarm Time'
      icon_template: 'mdi:alarm'
      value_template: '{{ "%0.02d:%0.02d" | format(states.input_number.alarm_clock_hour.state | int, states.input_number.alarm_clock_minute.state | int ) }}'
    alarm_clock_fade_in_minutes:
      friendly_name: 'Fade In (Minutes)'
      icon_template: 'mdi:gradient'
      value_template: '{{ states.input_number.alarm_clock_fade_in_minutes.state | int }}'

    movement_upstairs:
      value_template: >-
        {%- if is_state("switch.motionsensor", "off") and is_state("switch.motionsensor2", "off") -%}
          none
        {%- elif is_state("switch.motionsensor", "on") or is_state("switch.motionsensor2", "on") -%}
          motion
        {%- else -%}
          unknown
        {%- endif -%}

    last_movement_upstairs:
      value_template: '{{ as_timestamp(states.sensor.movement_upstairs.last_changed) | timestamp_custom("%a %d %b %H:%M") }}'

    main_door:
      value_template: >-
        {%- if is_state("switch.maindoor", "off") -%}
          closed
        {%- elif is_state("switch.maindoor", "on") -%}
          open
        {%- else -%}
          unknown
        {%- endif -%}

    last_main_door:
      value_template: '{{ as_timestamp(states.sensor.main_door.last_changed) | timestamp_custom("%a %d %b %H:%M") }}'

    # {{ (as_timestamp(now()) - as_timestamp(states.sensor.inngangsdor.last_changed)) }}
    # {{ (as_timestamp(trigger.to_state.last_changed) - as_timestamp(trigger.from_state.last_changed)) }}

    #  value_template: '{{ as_timestamp(states.sensor.main_door.attributes.last_triggered)  | timestamp_custom("%H:%M") }}'

    back_door:
      value_template: >-
        {%- if is_state("switch.backdoor", "off") -%}
          closed
        {%- elif is_state("switch.backdoor", "on") -%}
          open
        {%- else -%}
          unknown
        {%- endif -%}

    last_back_door:
      value_template: '{{ as_timestamp(states.sensor.back_door.last_changed) | timestamp_custom("%a %d %b %H:%M") }}'
    #  value_template: '{{ as_timestamp(states.sensor.back_door.attributes.last_triggered)  | timestamp_custom("%H:%M") }}'

#    last_sleeping:
#      value_template: '{{ as_timastamp(states.binary_sensor.sleeping.state == 'on') | timestamp_custom("%a %H:%M") }}'
#    last_awake:
#      value_template: '{{ as_timastamp(states.binary_sensor.sleeping.state == 'on') | timestamp_custom("%a %H:%M") }}'

    house_asleep_timestamp:
      value_template: '{{ as_timestamp(states.input_boolean.house_asleep.last_changed) | timestamp_custom("%H:%M") }}'
    house_awake_timestamp:
      value_template: '{{ as_timestamp(states.input_boolean.house_awake.last_changed) | timestamp_custom("%H:%M") }}'

    livingroom_battery:
      value_template: '{{ states.zwave.livingroom.attributes["battery_level"] }}'
      icon_template: >-
         {% if states.zwave.livingroom.attributes["battery_level"] > 90 %}mdi:battery
         {% elif states.zwave.livingroom.attributes["battery_level"] > 80 %}mdi:battery-90
         {% elif states.zwave.livingroom.attributes["battery_level"] > 70 %}mdi:battery-80
         {% elif states.zwave.livingroom.attributes["battery_level"] > 60 %}mdi:battery-70
         {% elif states.zwave.livingroom.attributes["battery_level"] > 50 %}mdi:battery-60
         {% elif states.zwave.livingroom.attributes["battery_level"] > 40 %}mdi:battery-50
         {% elif states.zwave.livingroom.attributes["battery_level"] > 30 %}mdi:battery-40
         {% elif states.zwave.livingroom.attributes["battery_level"] > 20 %}mdi:battery-30
         {% elif states.zwave.livingroom.attributes["battery_level"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    basement_battery:
      value_template: '{{ states.zwave.basement.attributes["battery_level"] }}'
      icon_template: >-
         {% if states.zwave.basement.attributes["battery_level"] > 90 %}mdi:battery
         {% elif states.zwave.basement.attributes["battery_level"] > 80 %}mdi:battery-90
         {% elif states.zwave.basement.attributes["battery_level"] > 70 %}mdi:battery-80
         {% elif states.zwave.basement.attributes["battery_level"] > 60 %}mdi:battery-70
         {% elif states.zwave.basement.attributes["battery_level"] > 50 %}mdi:battery-60
         {% elif states.zwave.basement.attributes["battery_level"] > 40 %}mdi:battery-50
         {% elif states.zwave.basement.attributes["battery_level"] > 30 %}mdi:battery-40
         {% elif states.zwave.basement.attributes["battery_level"] > 20 %}mdi:battery-30
         {% elif states.zwave.basement.attributes["battery_level"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    ebalcony_battery:
      value_template: '{{ states.zwave.eastbalcony.attributes["battery_level"] }}'
      icon_template: >-
         {% if states.zwave.eastbalcony.attributes["battery_level"] > 90 %}mdi:battery
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 80 %}mdi:battery-90
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 70 %}mdi:battery-80
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 60 %}mdi:battery-70
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 50 %}mdi:battery-60
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 40 %}mdi:battery-50
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 30 %}mdi:battery-40
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 20 %}mdi:battery-30
         {% elif states.zwave.eastbalcony.attributes["battery_level"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    hall_battery:
      value_template: '{{ states.zwave.hall.attributes["battery_level"] }}'
      icon_template: >-
         {% if states.zwave.hall.attributes["battery_level"] > 90 %}mdi:battery
         {% elif states.zwave.hall.attributes["battery_level"] > 80 %}mdi:battery-90
         {% elif states.zwave.hall.attributes["battery_level"] > 70 %}mdi:battery-80
         {% elif states.zwave.hall.attributes["battery_level"] > 60 %}mdi:battery-70
         {% elif states.zwave.hall.attributes["battery_level"] > 50 %}mdi:battery-60
         {% elif states.zwave.hall.attributes["battery_level"] > 40 %}mdi:battery-50
         {% elif states.zwave.hall.attributes["battery_level"] > 30 %}mdi:battery-40
         {% elif states.zwave.hall.attributes["battery_level"] > 20 %}mdi:battery-30
         {% elif states.zwave.hall.attributes["battery_level"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    hall2_battery:
      value_template: '{{ states.zwave.hall2.attributes["battery_level"] }}'
      icon_template: >-
         {% if states.zwave.hall2.attributes["battery_level"] > 90 %}mdi:battery
         {% elif states.zwave.hall2.attributes["battery_level"] > 80 %}mdi:battery-90
         {% elif states.zwave.hall2.attributes["battery_level"] > 70 %}mdi:battery-80
         {% elif states.zwave.hall2.attributes["battery_level"] > 60 %}mdi:battery-70
         {% elif states.zwave.hall2.attributes["battery_level"] > 50 %}mdi:battery-60
         {% elif states.zwave.hall2.attributes["battery_level"] > 40 %}mdi:battery-50
         {% elif states.zwave.hall2.attributes["battery_level"] > 30 %}mdi:battery-40
         {% elif states.zwave.hall2.attributes["battery_level"] > 20 %}mdi:battery-30
         {% elif states.zwave.hall2.attributes["battery_level"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    main_door_battery:
      value_template: '{{ states.zwave.main_door.attributes["battery_level"] }}'
      icon_template: >-
         {% if states.zwave.main_door.attributes["battery_level"] > 90 %}mdi:battery
         {% elif states.zwave.main_door.attributes["battery_level"] > 80 %}mdi:battery-90
         {% elif states.zwave.main_door.attributes["battery_level"] > 70 %}mdi:battery-80
         {% elif states.zwave.main_door.attributes["battery_level"] > 60 %}mdi:battery-70
         {% elif states.zwave.main_door.attributes["battery_level"] > 50 %}mdi:battery-60
         {% elif states.zwave.main_door.attributes["battery_level"] > 40 %}mdi:battery-50
         {% elif states.zwave.main_door.attributes["battery_level"] > 30 %}mdi:battery-40
         {% elif states.zwave.main_door.attributes["battery_level"] > 20 %}mdi:battery-30
         {% elif states.zwave.main_door.attributes["battery_level"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    wbalcony_battery:
      value_template: '{{ states.zwave.westbalcony.attributes["battery_level"] }}'
      icon_template: >-
         {% if states.zwave.westbalcony.attributes["battery_level"] > 90 %}mdi:battery
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 80 %}mdi:battery-90
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 70 %}mdi:battery-80
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 60 %}mdi:battery-70
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 50 %}mdi:battery-60
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 40 %}mdi:battery-50
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 30 %}mdi:battery-40
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 20 %}mdi:battery-30
         {% elif states.zwave.westbalcony.attributes["battery_level"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    thomas_iphone_battery:
      value_template: '{{ states.device_tracker.thomasiphone.attributes["battery"] }}'
      icon_template: >-
         {% if states.device_tracker.thomasiphone.attributes["battery"] > 90 %}mdi:battery
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 80 %}mdi:battery-90
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 70 %}mdi:battery-80
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 60 %}mdi:battery-70
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 50 %}mdi:battery-60
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 40 %}mdi:battery-50
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 30 %}mdi:battery-40
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 20 %}mdi:battery-30
         {% elif states.device_tracker.thomasiphone.attributes["battery"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}
    paula_iphone_battery:
      value_template: '{{ states.device_tracker.paulaiphone.attributes["battery"] }}'
      icon_template: >-
         {% if states.device_tracker.paulaiphone.attributes["battery"] > 90 %}mdi:battery
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 80 %}mdi:battery-90
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 70 %}mdi:battery-80
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 60 %}mdi:battery-70
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 50 %}mdi:battery-60
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 40 %}mdi:battery-50
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 30 %}mdi:battery-40
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 20 %}mdi:battery-30
         {% elif states.device_tracker.paulaiphone.attributes["battery"] > 10 %}mdi:battery-20
         {% else %}mdi:mdi:battery-10
         {% endif %}

#    low_battery:
#      friendly_name: "Low Battery"
#      value_template: >
#        {%- set threshold = 40 -%}
#        {%- set domains = ['light', 'switch', 'sensor', 'zwave', 'lock'] -%}
#        {%- for domain in domains -%}
#        {%- for item in states[domain] if ((item.attributes.battery_level is defined and item.attributes['battery_level'] | int < threshold) or ("battery" in item.name | lower and ((item.state | int < threshold and item.state|int != 0) or item.state | lower == "low" or item.state | lower == "unknown"))) -%}
#            {{ item.attributes.friendly_name }}{%- if not loop.last %}, {% endif -%}
#        {%- endfor -%}
#        {%- endfor -%}
